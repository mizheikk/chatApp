var chatApp=angular.module("chatApp",["ngRoute","chatAppControllers","chatAppServices"]);chatApp.config(["$routeProvider",function(e){e.when("/chat/:user/:timestamp",{templateUrl:"chat.html"}).otherwise({templateUrl:"login.html"})}]);var chatAppControllers=angular.module("chatAppControllers",[]);chatAppControllers.controller("loginController",function(e,t,r,s){t.addUser=function(){var e=t.newUsername,n=s.addUser(e);n.then(function(t){r.url("chat/"+e+"/"+t)},function(e){t.info="Failed: "+e},function(e){t.info="Failed: "+e})}}),chatAppControllers.controller("setMessageController",function(e,t,r,s){var n=t.user,a=t.timestamp;r.addMessage=function(){var t=s.checkTimestamp(n,a);t.then(function(){s.addMessage(n,r.newMessage),r.newMessage=""},function(){e.url("/"),alert("Error! Rotten session..")})}}),chatAppControllers.controller("getMessagesController",function(e,t){var r=t.getMessages();e.messages=r});var chatAppServices=angular.module("chatAppServices",["firebase"]);chatAppServices.service("FirebaseService",function(e,t,r){var s=new Firebase("https://luminous-torch-1910.firebaseio.com/"),n=s.child("users"),a=s.child("messages"),o=t(a);e(s);this.addUser=function(e){var t=r.defer();return n.once("value",function(r){if(0==r.child(e).exists()){var s=Date.now();n.child(e).set(s,function(e){e?t.reject(e):t.resolve(s)})}else t.reject("Username is already in use. Take another!")}),t.promise},this.getMessages=function(){return o},this.addMessage=function(e,t){var r=a.push();r.set({author:e,message:t})},this.checkTimestamp=function(e,t){var s=new Firebase("https://luminous-torch-1910.firebaseio.com/users/"+e),n=r.defer();return s.once("value",function(e){e.val()==t?n.resolve():n.reject()}),n.promise}});